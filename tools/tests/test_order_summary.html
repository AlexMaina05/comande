<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Order Summary Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 1200px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ðŸ§¾ Test Order Summary Display</h1>
    <p>This test verifies that order summary displays description, quantity, and total price correctly.</p>

    <div class="test-section">
        <h2>Test 1: Product Object Structure</h2>
        <div id="test1-results"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Display Table with Sample Products</h2>
        <table>
            <thead>
                <tr>
                    <th>Prodotto</th>
                    <th>Q.tÃ </th>
                    <th>Totale</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="test-table-body">
            </tbody>
        </table>
        <div id="test2-results"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Calculation Verification</h2>
        <div id="test3-results"></div>
    </div>

    <div class="summary" id="test-summary">
        <h3>Test Summary</h3>
        <p id="summary-text"></p>
    </div>

    <script>
        // Simulated test data matching the structure used in cassa.js
        const testProducts = [
            {
                ID_Prodotto: 1,
                Descrizione: "Pizza Margherita",
                Prezzo: 8.50
            },
            {
                ID_Prodotto: 2,
                Descrizione: "Coca Cola",
                Prezzo: 3.00
            },
            {
                ID_Prodotto: 3,
                Descrizione: "TiramisÃ¹",
                Prezzo: 5.50
            }
        ];

        let testsPassed = 0;
        let testsFailed = 0;

        // Helper function from cassa.js - duplicated here for test independence
        // This allows the test to run standalone without requiring the main application files
        function escapeHtml(str) {
            if (typeof str !== 'string') return str;
            return str.replace(/[&<>"'`=\/]/g, function (s) {
                return ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;',
                    '/': '&#x2F;',
                    '`': '&#x60;',
                    '=': '&#x3D;'
                })[s];
            });
        }

        // Test 1: Verify product object structure
        function test1_ProductStructure() {
            const results = document.getElementById('test1-results');
            let html = '';

            testProducts.forEach((product, index) => {
                const hasId = product.ID_Prodotto !== undefined;
                const hasDescription = product.Descrizione !== undefined && product.Descrizione !== '';
                const hasPrice = product.Prezzo !== undefined && typeof product.Prezzo === 'number';

                if (hasId && hasDescription && hasPrice) {
                    html += `<div class="pass">âœ“ Product ${index + 1}: All required fields present (ID: ${product.ID_Prodotto}, Description: "${escapeHtml(product.Descrizione)}", Price: â‚¬${product.Prezzo})</div>`;
                    testsPassed++;
                } else {
                    html += `<div class="fail">âœ— Product ${index + 1}: Missing fields</div>`;
                    testsFailed++;
                }
            });

            results.innerHTML = html;
        }

        // Test 2: Verify display in table
        function test2_TableDisplay() {
            const tableBody = document.getElementById('test-table-body');
            const results = document.getElementById('test2-results');
            let html = '';

            // Simulate adding products to order with quantity
            const orderItems = [
                { 
                    id_prodotto: testProducts[0].ID_Prodotto,
                    descrizione: testProducts[0].Descrizione,
                    prezzo_unitario: testProducts[0].Prezzo,
                    quantita: 2
                },
                {
                    id_prodotto: testProducts[1].ID_Prodotto,
                    descrizione: testProducts[1].Descrizione,
                    prezzo_unitario: testProducts[1].Prezzo,
                    quantita: 3
                },
                {
                    id_prodotto: testProducts[2].ID_Prodotto,
                    descrizione: testProducts[2].Descrizione,
                    prezzo_unitario: testProducts[2].Prezzo,
                    quantita: 1
                }
            ];

            // Render items in table (simulating aggiornaRiepilogo logic)
            orderItems.forEach((item, index) => {
                const riga = document.createElement("tr");
                const prezzoRiga = (item.prezzo_unitario || 0) * item.quantita;
                riga.innerHTML = `
                    <td>${escapeHtml(item.descrizione)}</td>
                    <td>${item.quantita}</td>
                    <td>${prezzoRiga.toFixed(2)} â‚¬</td>
                    <td><button type="button">X</button></td>
                `;
                tableBody.appendChild(riga);

                // Verify each field is present
                const cells = riga.querySelectorAll('td');
                const hasDescription = cells[0] && cells[0].textContent.trim() !== '';
                const hasQuantity = cells[1] && cells[1].textContent.trim() !== '';
                const hasTotal = cells[2] && cells[2].textContent.includes('â‚¬');

                if (hasDescription && hasQuantity && hasTotal) {
                    html += `<div class="pass">âœ“ Row ${index + 1}: Description "${escapeHtml(item.descrizione)}", Quantity ${item.quantita}, Total â‚¬${prezzoRiga.toFixed(2)} all displayed correctly</div>`;
                    testsPassed++;
                } else {
                    html += `<div class="fail">âœ— Row ${index + 1}: Missing display elements</div>`;
                    testsFailed++;
                }
            });

            results.innerHTML = html;
        }

        // Test 3: Verify total price calculations
        function test3_Calculations() {
            const results = document.getElementById('test3-results');
            let html = '';

            const testCases = [
                { price: 8.50, quantity: 2, expected: 17.00 },
                { price: 3.00, quantity: 3, expected: 9.00 },
                { price: 5.50, quantity: 1, expected: 5.50 },
                { price: 10.00, quantity: 0, expected: 0.00 },
                { price: 0, quantity: 5, expected: 0.00 }
            ];

            testCases.forEach((test, index) => {
                const calculated = (test.price || 0) * test.quantity;
                const isCorrect = Math.abs(calculated - test.expected) < 0.01; // Allow for floating point precision

                if (isCorrect) {
                    html += `<div class="pass">âœ“ Test ${index + 1}: â‚¬${test.price} Ã— ${test.quantity} = â‚¬${calculated.toFixed(2)} âœ“</div>`;
                    testsPassed++;
                } else {
                    html += `<div class="fail">âœ— Test ${index + 1}: â‚¬${test.price} Ã— ${test.quantity} = â‚¬${calculated.toFixed(2)} (expected â‚¬${test.expected.toFixed(2)})</div>`;
                    testsFailed++;
                }
            });

            results.innerHTML = html;
        }

        // Run all tests
        function runTests() {
            test1_ProductStructure();
            test2_TableDisplay();
            test3_Calculations();

            // Display summary
            const summaryText = document.getElementById('summary-text');
            const totalTests = testsPassed + testsFailed;
            summaryText.innerHTML = `
                <strong>Total Tests:</strong> ${totalTests}<br>
                <strong style="color: #155724;">Passed:</strong> ${testsPassed}<br>
                <strong style="color: #721c24;">Failed:</strong> ${testsFailed}<br>
                <strong>Result:</strong> ${testsFailed === 0 ? 'âœ“ All tests passed!' : 'âœ— Some tests failed'}
            `;
        }

        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
